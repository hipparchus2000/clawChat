<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="ClawChat - A modern WebSocket chat client with offline support">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ClawChat">
    <meta name="application-name" content="ClawChat">
    <meta name="msapplication-TileColor" content="#6366f1">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="/icons/icon-72x72.svg">
    <link rel="alternate icon" type="image/png" href="/icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    <link rel="mask-icon" href="/icons/icon-192x192.svg" color="#6366f1">
    
    <title>ClawChat</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="chat.css">
    
    <!-- Service Worker Registration -->
    <script>
        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('[PWA] Service Worker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('[PWA] Service Worker registration failed:', error);
                    });
            });
        }
        
        // Handle beforeinstallprompt for PWA install
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            window.dispatchEvent(new CustomEvent('pwaInstallable'));
        });
        
        // Listen for app installed
        window.addEventListener('appinstalled', () => {
            deferredPrompt = null;
            console.log('[PWA] App was installed');
        });
    </script>
</head>
<body>
    <div id="app">
        <!-- Header with connection status -->
        <header class="app-header">
            <div class="header-left">
                <div class="logo">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                    </svg>
                    <h1>ClawChat</h1>
                </div>
            </div>
            <div class="header-right">
                <div id="connection-status" class="connection-status disconnected" aria-live="polite">
                    <span class="status-dot" aria-hidden="true"></span>
                    <span class="status-text">Disconnected</span>
                </div>
                <button id="install-btn" class="icon-btn" aria-label="Install app" title="Install app" hidden>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                </button>
                <button id="settings-btn" class="icon-btn" aria-label="Settings" title="Settings">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 1v6m0 6v6m4.22-10.22l4.24-4.24M6.34 6.34L2.1 2.1m17.8 17.8l-4.24-4.24M6.34 17.66l-4.24 4.24M1 12h6m6 0h6"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-nav" role="tablist" aria-label="Main tabs">
            <button 
                id="tab-messages" 
                class="tab-btn active" 
                role="tab" 
                aria-selected="true" 
                aria-controls="panel-messages"
                tabindex="0"
            >
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                </svg>
                <span>Messages</span>
            </button>
            <button 
                id="tab-files" 
                class="tab-btn" 
                role="tab" 
                aria-selected="false" 
                aria-controls="panel-files"
                tabindex="-1"
            >
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                    <polyline points="10 9 9 9 8 9"/>
                </svg>
                <span>Files</span>
            </button>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Messages Panel -->
            <section 
                id="panel-messages" 
                class="tab-panel active" 
                role="tabpanel" 
                aria-labelledby="tab-messages"
            >
                <div class="chat-container">
                    <!-- Messages List -->
                    <div id="messages-container" class="messages-container" aria-live="polite" aria-atomic="false">
                        <div class="empty-state" id="empty-messages">
                            <div class="empty-icon">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                                </svg>
                            </div>
                            <p>Welcome to ClawChat!</p>
                            <p class="empty-subtitle">Connect to start messaging</p>
                        </div>
                    </div>

                    <!-- Message Input -->
                    <div class="message-input-container">
                        <form id="message-form" class="message-form" novalidate>
                            <div class="input-wrapper">
                                <input 
                                    type="text" 
                                    id="message-input" 
                                    class="message-input" 
                                    placeholder="Type a message..." 
                                    autocomplete="off"
                                    maxlength="2000"
                                    aria-label="Message input"
                                    disabled
                                >
                                <button 
                                    type="submit" 
                                    id="send-btn" 
                                    class="send-btn" 
                                    aria-label="Send message"
                                    disabled
                                >
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="22" y1="2" x2="11" y2="13"/>
                                        <polygon points="22 2 15 22 11 13 2 9"/>
                                    </svg>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Files Panel (Placeholder) -->
            <section 
                id="panel-files" 
                class="tab-panel" 
                role="tabpanel" 
                aria-labelledby="tab-files"
                hidden
            >
                <div class="files-placeholder">
                    <div class="placeholder-icon">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10 9 9 9 8 9"/>
                        </svg>
                    </div>
                    <h2>Files</h2>
                    <p>File sharing coming soon!</p>
                    <p class="placeholder-note">This feature will allow you to share and manage files in your conversations.</p>
                </div>
            </section>
        </main>

        <!-- Connection Settings Modal -->
        <div id="settings-modal" class="modal" role="dialog" aria-labelledby="settings-title" aria-hidden="true">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="settings-title">Connection Settings</h2>
                    <button id="close-modal" class="icon-btn" aria-label="Close settings">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <form id="connection-form" class="settings-form">
                    <div class="form-group">
                        <label for="ws-host">WebSocket Host</label>
                        <input 
                            type="text" 
                            id="ws-host" 
                            placeholder="localhost" 
                            value="localhost"
                            required
                        >
                    </div>
                    <div class="form-group">
                        <label for="ws-port">Port</label>
                        <input 
                            type="number" 
                            id="ws-port" 
                            placeholder="8080" 
                            value="8080"
                            min="1"
                            max="65535"
                            required
                        >
                    </div>
                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="use-ssl">
                            <span class="checkbox-text">Use secure connection (WSS)</span>
                        </label>
                    </div>
                    <div class="form-actions">
                        <button type="button" id="disconnect-btn" class="btn btn-secondary" disabled>
                            Disconnect
                        </button>
                        <button type="submit" id="connect-btn" class="btn btn-primary">
                            Connect
                        </button>
                    </div>
                </form>
                <div id="connection-error" class="connection-error" role="alert" aria-live="assertive"></div>
            </div>
        </div>

        <!-- Toast Notifications Container -->
        <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>
    </div>

    <!-- JavaScript Modules -->
    <script type="module" src="app.js"></script>
</body>
</html>
